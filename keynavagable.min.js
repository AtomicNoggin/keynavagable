!function(){var e=new WeakMap,t=new WeakMap,n=new WeakMap,i={},o=Element.prototype;Object.defineProperties(o,{tabNext:{get:function(){var e=n.get(this);return e&&e.next?e.next:document.getElementById(this.getAttribute("tab-next"))},set:function(e){var t=n.get(this)||{};e instanceof Element?(t.next=e,this.removeAttribute("tab-next")):e===String(e)&&e.length?(t.next=null,this.setAttribute("tab-next",e)):(t.next=null,this.removeAttribute("tab-next")),n.set(this,t)},enumerable:!0,configurable:!0},tabPrevious:{get:function(){var e=n.get(this);return e&&e.prev?e.prev:document.getElementById(this.getAttribute("tab-previous"))},set:function(e){var t=n.get(this)||{};e instanceof Element?(t.previous=e,this.removeAttribute("tab-previous")):e===String(e)&&e.length?(t.previous=null,this.setAttribute("tab-previous",e)):(t.previous=null,this.removeAttribute("tab-previous")),n.set(this,t)},enumerable:!0,configurable:!0}}),o.setKeyAction=function(t,n,i){var o=e.get(this)||{};i=i instanceof Element?i:this,n&&n===""+n&&i[n]instanceof Function?n=i[n]:"function"!=typeof n&&(n=function(){}),n&&(console.log("setting keyaction "+t+" for element"),console.log(i),o[t]=n.bind(i),e.set(this,o))},o.removeKeyAction=function(t){var n=e.get(this);n&&n[t]&&(delete n[t],Object.keys(n).length?e.set(this,n):e.delete(this))},o.captureKeyAction=function(e,n,o){var s=t.get(this)||{};myCapture[e]||(i[e]?i[e]++:i[e]=1),o=o instanceof Element?o:this,n&&n===""+n&&o[n]instanceof Function?n=o[n]:n instanceof Function||(n=function(){}),s[e]=n.bind(o),t.set(this,s)},o.releaseKeyAction=function(e){var n=t.get(this);n&&n[this]&&(delete n[this],i[e]--,Object.keys(n).length?t.set(this,n):t.delete(this))},document.addEventListener("keydown",function(n){var o=" "!==n.key?n.key:"Space",s=document.activeElement,a=e.get(s),l=s;if(!s.isContentEditable)if(o=(n.altKey&&"Alt"!==o?"Alt-":"")+(n.ctrlKey&&"Control"!==o?"Control-":"")+(n.keyMeta&&"Meta"!==o?"Meta-":"")+(n.shiftKey&&o.length>1&&"Shift"!==o?"Shift-":"")+o,console.log(o),a&&a[o])s.dispatchEvent(r())&&(n.preventDefault(),console.log(a[o]),a[o]());else if("Tab"==o&&(s=s.tabNext))s.focus(),n.preventDefault();else if("Shift-Tab"==o&&(s=s.tabPrevious))s.focus(),n.preventDefault();else if(i[o]){do{l=l.parentElement,a=t.get(l)}while(l&&!a||!a[o]);l&&l.dispatchEvent(r())&&(n.preventDefault(),console.log(a[o]),a[o]())}function r(){return new CustomEvent("keynavigation",{cancelable:!0,bubbles:!0,details:{key:n.key,altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,metaKey:n.metaKey,relatedTarget:s}})}},!0)}();
